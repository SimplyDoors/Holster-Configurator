<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SimplyDoors v2.4 (Universal)</title>
    <style>
        /* --- CORE THEME --- */
        :root {
            --primary: #3e2723; /* Dark Mahogany */
            --accent: #8d6e63;
            --bg: #f8f9fa;
            --white: #ffffff;
            --text-dark: #212529;
            --text-light: #6c757d;
            --border: #dee2e6;
            --active-bg: #e9ecef;
        }

        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text-dark); margin: 0; padding: 20px; padding-bottom: 80px; }
        * { box-sizing: border-box; }

        header { text-align: center; margin-bottom: 25px; background: var(--white); padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        h1 { margin: 0; font-size: 1.5rem; color: var(--primary); letter-spacing: -0.5px; }
        .subtitle { font-size: 0.8rem; color: var(--text-light); text-transform: uppercase; font-weight: 700; margin-top: 5px; }

        /* DESKTOP FIX: Keeps app centered on large screens */
        .container { max-width: 800px; margin: 0 auto; }
        
        /* --- GRIDS --- */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .list-grid { display: grid; gap: 10px; }

        /* --- CARDS --- */
        .card { background: var(--white); border: 1px solid var(--border); border-radius: 10px; padding: 15px; text-align: center; cursor: pointer; transition: all 0.2s; position: relative; }
        /* HOVER: Adds a nice lift effect for Mouse Users */
        .card:hover { border-color: var(--primary); transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .card-title { font-weight: 700; font-size: 0.9rem; color: var(--primary); display: block; margin-top: 10px; line-height: 1.2; }
        
        /* --- BUTTONS --- */
        .btn { width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 1rem; margin-top: 20px; cursor: pointer; transition: background 0.2s; }
        .btn:hover { background: #2b1b18; }
        .btn-secondary { background: #fff; color: var(--text-dark); border: 1px solid var(--border); margin-top: 10px; }
        .btn-secondary:hover { background: #f0f0f0; }

        /* --- NAVIGATION --- */
        .nav-header { display: flex; align-items: center; margin-bottom: 15px; }
        .back-btn { background: none; border: none; font-size: 1.2rem; color: var(--primary); font-weight: 700; cursor: pointer; padding-right: 10px; }
        .page-title { flex: 1; text-align: center; font-weight: 700; color: var(--text-light); font-size: 1rem; }

        /* --- SVG STYLES --- */
        svg { display: block; margin: 0 auto; }
        .svg-line { fill: none; stroke: #333; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .svg-fill { fill: #fff; stroke: #333; stroke-width: 2; }
        .svg-label { font-family: sans-serif; font-size: 10px; fill: #999; text-anchor: middle; font-weight: bold; }
        .swing-path { fill: none; stroke: var(--primary); stroke-width: 1.5; stroke-dasharray: 4; marker-end: url(#arrow); }
        .wall-line { stroke: #ccc; stroke-width: 4; }

        /* --- OPTIONS --- */
        .opt-group { margin-bottom: 20px; text-align: left; }
        .opt-label { font-size: 0.75rem; font-weight: 700; color: var(--text-light); text-transform: uppercase; display: block; margin-bottom: 8px; }
        .chip-container { display: flex; flex-wrap: wrap; gap: 8px; }
        .chip { padding: 8px 14px; border: 1px solid var(--border); border-radius: 20px; font-size: 0.85rem; font-weight: 600; cursor: pointer; background: white; color: var(--text-dark); }
        .chip:hover { border-color: #aaa; }
        .chip.selected { background: var(--primary); color: white; border-color: var(--primary); }

        /* --- LIVE PRICE BAR --- */
        .price-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #ddd; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 100; }
        .pb-label { font-size: 0.8rem; color: #666; font-weight: 600; text-transform: uppercase; }
        .pb-val { font-size: 1.4rem; color: var(--primary); font-weight: 800; }

        /* --- VIEWS --- */
        .view { display: none; animation: fadeIn 0.25s ease-out; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- REVIEW --- */
        .review-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .review-table td { padding: 12px 0; border-bottom: 1px solid #eee; font-size: 0.95rem; }
        .r-label { font-weight: 600; color: var(--text-light); width: 35%; }
        .r-val { text-align: right; color: var(--text-dark); font-weight: 500; }
        
        .sku-box { 
            background: #e3f2fd; 
            color: #0d47a1; 
            font-family: monospace; 
            padding: 10px; 
            border-radius: 6px; 
            font-weight: 700; 
            display: block; 
            margin-top: 5px; 
            border: 1px solid #bbdefb;
            font-size: 1.1rem;
            line-height: 1.4;
            word-wrap: break-word;
        }
        .line-item { font-size:0.85rem; color:#555; display:flex; justify-content:space-between; margin-top:4px; }
        
        /* --- PRINT STYLES (Desktop Optimized) --- */
        #print-header { display: none; }
        
        @media print {
            /* Reset body for print */
            body { background: white; padding: 0; font-size: 12pt; color: black; -webkit-print-color-adjust: exact; }
            
            /* Hide UI Elements */
            header, .nav-header, .btn, .price-bar, .subtitle, .chip-container, .opt-group { display: none !important; }
            
            /* Max Width override for Desktop Printing */
            .container { max-width: 100% !important; width: 100% !important; margin: 0; }
            
            .card { border: none; box-shadow: none; padding: 0; margin: 0 !important; }
            .view { display: none; }
            #v-review { display: block !important; } /* Only show review */
            
            #print-header { display: block; text-align: center; margin-bottom: 30px; border-bottom: 2px solid #000; padding-bottom: 20px; }
            #print-header h1 { color: #000; font-size: 24pt; margin: 0; }
            #print-header p { margin: 5px 0 0 0; color: #555; }
            
            .sku-box { background: #fff !important; border: 2px solid #000; color: #000; font-size: 14pt; padding: 15px; margin-bottom: 20px; }
            .review-table td { border-bottom: 1px solid #ccc; padding: 10px 0; color: #000 !important; }
            .r-label { color: #000; }
            .total-row { border-top: 3px solid #000; }
            .total-price { color: #000; }
        }
    </style>
</head>
<body>

<svg style="display:none;">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="var(--primary)" />
    </marker>
  </defs>
</svg>

<div id="print-header">
    <h1>SimplyDoors Order Ticket</h1>
    <p id="print-date"></p>
</div>

<header>
    <h1>SimplyDoors</h1>
    <div class="subtitle">Dealer Configurator v2.4</div>
</header>

<div class="container">

    <div id="v-material" class="view active">
        <div class="opt-label" style="text-align:center;">Select Material</div>
        <div class="grid-2">
            <div class="card" onclick="app.setMaterial('Mahogany')">
                <div style="height:60px; background:#4e342e; border-radius:6px; margin-bottom:10px;"></div>
                <span class="card-title">Mahogany</span>
            </div>
            <div class="card" onclick="app.setMaterial('Knotty Alder')">
                <div style="height:60px; background:#8d6e63; border-radius:6px; margin-bottom:10px;"></div>
                <span class="card-title">Knotty Alder</span>
            </div>
        </div>
    </div>

    <div id="v-height" class="view">
        <div class="nav-header"><button class="back-btn" onclick="app.back()">←</button><span class="page-title">Height</span></div>
        <div class="grid-2">
            <div class="card" onclick="app.setHeight(68)"><span class="card-title" style="font-size:2rem;">6'8"</span></div>
            <div class="card" onclick="app.setHeight(80)"><span class="card-title" style="font-size:2rem;">8'0"</span></div>
        </div>
    </div>

    <div id="v-width" class="view">
        <div class="nav-header"><button class="back-btn" onclick="app.back()">←</button><span class="page-title">Width</span></div>
        <div class="grid-3" id="width-grid"></div>
    </div>

    <div id="v-config" class="view">
        <div class="nav-header"><button class="back-btn" onclick="app.back()">←</button><span class="page-title">Configuration</span></div>
        <div class="grid-3" id="config-grid"></div>
    </div>

    <div id="v-swing" class="view">
        <div class="nav-header"><button class="back-btn" onclick="app.back()">←</button><span class="page-title">Handing & Swing</span></div>
        <div class="grid-2">
            <div class="card" onclick="app.setSwing('LH Inswing')">
                <svg width="100" height="100" viewBox="0 0 100 100">
                    <text x="50" y="15" class="svg-label">INTERIOR</text>
                    <line x1="10" y1="50" x2="90" y2="50" class="wall-line" />
                    <text x="50" y="90" class="svg-label">EXTERIOR</text>
                    <rect x="20" y="48" width="4" height="4" fill="#000" />
                    <rect x="20" y="20" width="4" height="30" fill="var(--primary)" transform="rotate(-45 22 50)" />
                    <path d="M22 20 A30 30 0 0 1 52 50" class="swing-path" />
                </svg>
                <span class="card-title">Left Hand Inswing</span>
            </div>
            <div class="card" onclick="app.setSwing('RH Inswing')">
                <svg width="100" height="100" viewBox="0 0 100 100">
                    <text x="50" y="15" class="svg-label">INTERIOR</text>
                    <line x1="10" y1="50" x2="90" y2="50" class="wall-line" />
                    <text x="50" y="90" class="svg-label">EXTERIOR</text>
                    <rect x="76" y="48" width="4" height="4" fill="#000" />
                    <rect x="76" y="20" width="4" height="30" fill="var(--primary)" transform="rotate(45 78 50)" />
                    <path d="M78 20 A30 30 0 0 0 48 50" class="swing-path" />
                </svg>
                <span class="card-title">Right Hand Inswing</span>
            </div>
            <div class="card" onclick="app.setSwing('LH Outswing')">
                <svg width="100" height="100" viewBox="0 0 100 100">
                    <text x="50" y="15" class="svg-label">INTERIOR</text>
                    <line x1="10" y1="50" x2="90" y2="50" class="wall-line" />
                    <text x="50" y="90" class="svg-label">EXTERIOR</text>
                    <rect x="20" y="48" width="4" height="4" fill="#000" />
                    <rect x="20" y="50" width="4" height="30" fill="var(--primary)" transform="rotate(45 22 50)" />
                    <path d="M22 50 L22 80 A30 30 0 0 0 52 50" class="swing-path" />
                </svg>
                <span class="card-title">Left Hand Outswing</span>
            </div>
            <div class="card" onclick="app.setSwing('RH Outswing')">
                <svg width="100" height="100" viewBox="0 0 100 100">
                    <text x="50" y="15" class="svg-label">INTERIOR</text>
                    <line x1="10" y1="50" x2="90" y2="50" class="wall-line" />
                    <text x="50" y="90" class="svg-label">EXTERIOR</text>
                    <rect x="76" y="48" width="4" height="4" fill="#000" />
                    <rect x="76" y="50" width="4" height="30" fill="var(--primary)" transform="rotate(-45 78 50)" />
                    <path d="M78 80 A30 30 0 0 1 48 50" class="swing-path" />
                </svg>
                <span class="card-title">Right Hand Outswing</span>
            </div>
        </div>
    </div>

    <div id="v-category" class="view">
        <div class="nav-header"><button class="back-btn" onclick="app.back()">←</button><span class="page-title">Collection</span></div>
        <div class="grid-3" id="cat-grid"></div>
    </div>

    <div id="v-doors" class="view">
        <div class="nav-header"><button class="back-btn" onclick="app.back()">←</button><span class="page-title">Select Door</span></div>
        <div class="list-grid" id="door-list"></div>
    </div>

    <div id="v-options" class="view">
        <div class="nav-header"><button class="back-btn" onclick="app.back()">←</button><span class="page-title">Options</span></div>
        <div class="card" style="text-align:left; cursor:default; margin-bottom:60px;">
            <h3 id="opt-door-name" style="margin:0 0 5px 0; color:#3e2723;">--</h3>
            <div id="opt-config-name" style="font-size:0.8rem; color:#666; margin-bottom:20px;">--</div>

            <div class="opt-group">
                <span class="opt-label">Finish</span>
                <div class="chip-container">
                    <div class="chip selected" id="fin-unf" onclick="app.setOpt('finish', 'unf')">Unfinished</div>
                    <div class="chip" id="fin-pre" onclick="app.setOpt('finish', 'pre')">Prefinished</div>
                </div>
            </div>

            <div class="opt-group" id="stain-group" style="display:none;">
                <span class="opt-label">Stain Color</span>
                <div class="chip-container" id="stain-list"></div>
            </div>

            <div class="opt-group" id="glass-group" style="display:none;">
                <span class="opt-label">Glass</span>
                <div class="chip-container" style="margin-bottom:10px;">
                    <div class="chip selected" id="gl-open" onclick="app.setOpt('glass', 'open')">Open</div>
                    <div class="chip" id="gl-install" onclick="app.setOpt('glass', 'install')">With Glass</div>
                </div>
                <select id="glass-texture" onchange="app.setOpt('texture', this.value)" style="width:100%; padding:10px; border:1px solid #ddd; display:none;"></select>
            </div>

            <div class="opt-group" id="caming-group" style="display:none;">
                <span class="opt-label">Caming</span>
                <div class="chip-container">
                    <div class="chip selected" id="cam-patina" onclick="app.setOpt('caming', 'Patina')">Patina</div>
                    <div class="chip" id="cam-zinc" onclick="app.setOpt('caming', 'Zinc')">Zinc</div>
                </div>
            </div>

            <button class="btn" onclick="app.renderReview()">Review Order</button>
        </div>
        
        <div id="live-price-bar" class="price-bar">
            <span class="pb-label">Est. Total</span>
            <span class="pb-val" id="opt-live-price">$0</span>
        </div>
    </div>

    <div id="v-review" class="view">
        <div class="nav-header"><button class="back-btn" onclick="app.back()">←</button><span class="page-title">Summary</span></div>
        <div class="card" style="text-align:left; cursor:default;">
            <div id="review-content"></div>
            <div class="total-row">
                <span style="font-weight:bold; color:#555;">Final List Price</span>
                <span class="total-price" id="total-price">$0</span>
            </div>
            <button class="btn" onclick="window.print()">Print Order Sheet</button>
            <button class="btn btn-secondary" onclick="app.goHome()">Start Over</button>
        </div>
    </div>

</div>

<script>
// --- ICONS ---
const svgs = {
    c1: `<svg width="60" height="60" viewBox="0 0 60 60"><rect x="20" y="10" width="20" height="40" class="svg-fill"/></svg>`,
    c2: `<svg width="60" height="60" viewBox="0 0 60 60"><rect x="15" y="10" width="20" height="40" class="svg-fill"/><rect x="37" y="10" width="8" height="40" class="svg-fill"/></svg>`,
    c3: `<svg width="60" height="60" viewBox="0 0 60 60"><rect x="5" y="10" width="8" height="40" class="svg-fill"/><rect x="15" y="10" width="30" height="40" class="svg-fill"/><rect x="47" y="10" width="8" height="40" class="svg-fill"/></svg>`,
    c4: `<svg width="60" height="60" viewBox="0 0 60 60"><rect x="5" y="0" width="50" height="8" class="svg-fill"/><rect x="5" y="10" width="8" height="40" class="svg-fill"/><rect x="15" y="10" width="30" height="40" class="svg-fill"/><rect x="47" y="10" width="8" height="40" class="svg-fill"/></svg>`,
    c5: `<svg width="60" height="60" viewBox="0 0 60 60"><path d="M5 10 Q30 -5 55 10 L55 8 L5 8 Z" class="svg-fill"/><rect x="5" y="10" width="8" height="40" class="svg-fill"/><rect x="15" y="10" width="30" height="40" class="svg-fill"/><rect x="47" y="10" width="8" height="40" class="svg-fill"/></svg>`,
    c6: `<svg width="60" height="60" viewBox="0 0 60 60"><path d="M5 10 Q30 -10 55 10 L55 8 L5 8 Z" class="svg-fill"/><rect x="5" y="10" width="8" height="40" class="svg-fill"/><rect x="15" y="10" width="30" height="40" class="svg-fill"/><rect x="47" y="10" width="8" height="40" class="svg-fill"/></svg>`,
    c7: `<svg width="60" height="60" viewBox="0 0 60 60"><path d="M5 10 A25 25 0 0 1 55 10 L5 10 Z" class="svg-fill"/><rect x="5" y="10" width="8" height="40" class="svg-fill"/><rect x="15" y="10" width="30" height="40" class="svg-fill"/><rect x="47" y="10" width="8" height="40" class="svg-fill"/></svg>`,
    c8: `<svg width="60" height="60" viewBox="0 0 60 60"><rect x="8" y="10" width="20" height="40" class="svg-fill"/><rect x="30" y="10" width="20" height="40" class="svg-fill"/></svg>`,
    c9: `<svg width="60" height="60" viewBox="0 0 60 60"><rect x="8" y="0" width="42" height="8" class="svg-fill"/><rect x="8" y="10" width="20" height="40" class="svg-fill"/><rect x="30" y="10" width="20" height="40" class="svg-fill"/></svg>`,
    c10: `<svg width="60" height="60" viewBox="0 0 60 60"><path d="M8 10 Q29 -5 50 10" class="svg-fill" style="fill:none;"/><rect x="8" y="10" width="20" height="40" class="svg-fill"/><rect x="30" y="10" width="20" height="40" class="svg-fill"/><path d="M8 10 Q29 -5 50 10 L50 8 Q29 -7 8 8 Z" class="svg-fill"/></svg>`,
    c11: `<svg width="60" height="60" viewBox="0 0 60 60"><path d="M8 10 Q29 -10 50 10 L50 8 Q29 -12 8 8 Z" class="svg-fill"/><rect x="8" y="10" width="20" height="40" class="svg-fill"/><rect x="30" y="10" width="20" height="40" class="svg-fill"/></svg>`,
    c12: `<svg width="60" height="60" viewBox="0 0 60 60"><path d="M8 10 A21 21 0 0 1 50 10 L8 10 Z" class="svg-fill"/><rect x="8" y="10" width="20" height="40" class="svg-fill"/><rect x="30" y="10" width="20" height="40" class="svg-fill"/></svg>`
};

const DB = {
    configs: [
        {id:1, name:"Single Door", d:1, sl:0, t:false, icon:svgs.c1},
        {id:2, name:"Single + 1 SL", d:1, sl:1, t:false, icon:svgs.c2},
        {id:3, name:"Single + 2 SL", d:1, sl:2, t:false, icon:svgs.c3},
        {id:4, name:"S + Rect Transom", d:1, sl:2, t:true, icon:svgs.c4},
        {id:5, name:"S + Seg Transom", d:1, sl:2, t:true, icon:svgs.c5},
        {id:6, name:"S + Ellip Transom", d:1, sl:2, t:true, icon:svgs.c6},
        {id:7, name:"S + 1/2 Rd Transom", d:1, sl:2, t:true, icon:svgs.c7},
        {id:8, name:"Double Door", d:2, sl:0, t:false, icon:svgs.c8},
        {id:9, name:"Dbl + Rect Transom", d:2, sl:0, t:true, icon:svgs.c9},
        {id:10, name:"Dbl + Seg Transom", d:2, sl:0, t:true, icon:svgs.c10},
        {id:11, name:"Dbl + Ellip Transom", d:2, sl:0, t:true, icon:svgs.c11},
        {id:12, name:"Dbl + 1/2 Rd Transom", d:2, sl:0, t:true, icon:svgs.c12}
    ],
    stains: ["Jacobean", "Special Walnut", "English Chestnut", "Red Oak", "Velvet Smoke", "Ebony"],
    textures: [
        {name: "Clear Bevel", code:"CBL", priv: 1}, {name: "Baroque", code:"BRQ", priv: 2}, 
        {name: "Gluechip Bevel", code:"GCB", priv: 3}, {name: "Gluechip", code:"GLC", priv: 4}, 
        {name: "Water", code:"WAT", priv: 5}, {name: "Hammered", code:"HAM", priv: 6},
        {name: "Reeded", code:"RED", priv: 7}, {name: "Granite", code:"GRN", priv: 8}, 
        {name: "Flemish", code:"FLM", priv: 3}, {name: "Rain", code:"RN", priv: 6}, 
        {name: "Stippolyte", code:"STP", priv: 5}
    ],
    categories: [
        { name: "6 PANEL", pages: [9,31], active: true },
        { name: "FULL LITE", pages: [10], active: true },
        { name: "3/4 LITE", pages: [12,13,14,15,33], active: true },
        { name: "2/3 LITE", pages: [16,17,35], active: true },
        { name: "2/3 ARCH", pages: [18,19], active: true },
        { name: "1/2 LITE", pages: [20,39], active: true },
        { name: "TWIN LITE", pages: [21,22,23], active: true },
        { name: "OVAL", pages: [24,25,26,40], active: true },
        { name: "FAN LITE", pages: [27], active: true }
    ],
    doors: [
        // Page 9
        {id:"M6P", name:"Plain 6 Panel", baseId:"M6P", page:9, mat:"Mahogany", variants:[{w:32,h:68},{w:36,h:68}], configs:[1,8], price:{us:621, ug:0, ps:1052, pg:0}},
        {id:"M6PRM", name:"6 Panel Raised Moulding", baseId:"M6PRM", page:9, mat:"Mahogany", variants:[{w:36,h:68}], configs:[1,8], price:{us:759, ug:0, ps:1190, pg:0}},
        {id:"M6PRM6L", name:"6 Panel RM (6 Lite)", baseId:"M6PRM6L", page:9, mat:"Mahogany", variants:[{w:36,h:68}], configs:[1,8], price:{us:915, ug:1518, ps:1346, pg:1949}},
        // Page 10
        {id:"MFULLCOR", name:"Cornell Full Lite", baseId:"MFULLCOR", page:10, mat:"Mahogany", suffix:"COR", hasCaming:true, variants:[{w:36,h:68}], configs:"all", price:{us:449, ug:1308, ps:880, pg:1739}},
        {id:"MFULLDAR", name:"Dartmouth Full Lite", baseId:"MFULLDAR", page:10, mat:"Mahogany", suffix:"DAR", hasCaming:true, variants:[{w:36,h:68}], configs:"all", price:{us:449, ug:1308, ps:880, pg:1739}},
        {id:"MFULLPRI", name:"Princeton Full Lite", baseId:"MFULLPRI", page:10, mat:"Mahogany", suffix:"PRI", hasCaming:true, variants:[{w:36,h:68}], configs:"all", price:{us:449, ug:1308, ps:880, pg:1739}},
        {id:"MFULLHAR", name:"Harvard Full Lite", baseId:"MFULLHAR", page:10, mat:"Mahogany", suffix:"HAR", hasCaming:true, variants:[{w:36,h:68}], configs:"all", price:{us:449, ug:1308, ps:880, pg:1739}},
        // 8'0" Doors (Restored)
        {id:"M30806P", name:"3'0\" 6 Panel (8'0\")", baseId:"M30806P", page:31, mat:"Mahogany", variants:[{w:36,h:80}], configs:[1,8], price:{us:897, ug:0, ps:1414, pg:0}},
    ],
    sidelights: [
        {page:9, name:"Full Lite SL", base:"MFULLSLCBLE", price:{us:314, ug:682, ps:616, pg:984}},
        {page:10, name:"Full Lite SL", base:"MFULLSL", price:{us:314, ug:915, ps:616, pg:1217}}
    ]
};

const app = {
    state: { history:[], mat:null, h:null, w:null, config:null, swing:null, catPage:null, door:null, opt:{finish:'unf', stain:null, glass:'open', texture:'Clear Bevel', caming:'Patina', slSize:12} },
    
    init: () => {
        const sl = document.getElementById('stain-list');
        DB.stains.forEach(s => sl.innerHTML+=`<div class="chip" onclick="app.setOpt('stain','${s}', this)">${s}</div>`);
        const gt = document.getElementById('glass-texture');
        DB.textures.forEach(t => gt.innerHTML+=`<option value="${t.name}">${t.name} (Privacy: ${t.priv})</option>`);
        
        const now = new Date();
        document.getElementById('print-date').innerText = now.toLocaleDateString() + " " + now.toLocaleTimeString();
    },

    nav: (id) => {
        if(document.querySelector('.view.active')) app.state.history.push(document.querySelector('.view.active').id);
        document.querySelectorAll('.view').forEach(e=>e.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('live-price-bar').style.display = (id === 'v-options') ? 'flex' : 'none';
    },
    back: () => {
        if(app.state.history.length) {
            const prev = app.state.history.pop();
            document.querySelectorAll('.view').forEach(e=>e.classList.remove('active'));
            document.getElementById(prev).classList.add('active');
            document.getElementById('live-price-bar').style.display = (prev === 'v-options') ? 'flex' : 'none';
        }
    },
    goHome: () => location.reload(),

    setMaterial: (m) => { app.state.mat = m; app.nav('v-height'); },
    setHeight: (h) => { app.state.h = h; app.renderWidths(); app.nav('v-width'); },
    renderWidths: () => {
        const wg = document.getElementById('width-grid'); wg.innerHTML = '';
        const widths = [...new Set(DB.doors.filter(d=>d.mat===app.state.mat && d.variants.some(v=>v.h===app.state.h)).flatMap(d=>d.variants.map(v=>v.w)))].sort();
        widths.forEach(w => wg.innerHTML += `<div class="card" onclick="app.setWidth(${w})"><span class="card-title">${w===36?"3'0\"":(w===32?"2'8\"":w)}</span></div>`);
    },
    setWidth: (w) => { app.state.w = w; app.renderConfigs(); app.nav('v-config'); },
    renderConfigs: () => {
        const cg = document.getElementById('config-grid'); cg.innerHTML = '';
        DB.configs.forEach(c => {
            cg.innerHTML += `<div class="card" style="padding:10px;" onclick="app.setConfig(${c.id})">${c.icon}<span style="font-size:0.75rem; font-weight:700; display:block; margin-top:5px;">#${c.id}<br>${c.name}</span></div>`;
        });
    },
    setConfig: (id) => { app.state.config = DB.configs.find(c=>c.id===id); app.nav('v-swing'); },
    setSwing: (s) => { app.state.swing = s; app.renderCats(); app.nav('v-category'); },
    renderCats: () => {
        const cg = document.getElementById('cat-grid'); cg.innerHTML = '';
        DB.categories.forEach(c => {
            if(c.active) cg.innerHTML += `<div class="card" onclick="app.setCat([${c.pages}])"><span class="card-title">${c.name}</span></div>`;
            else cg.innerHTML += `<div class="card" style="opacity:0.5; cursor:default;"><span class="card-title">${c.name}</span><small>Data Needed</small></div>`;
        });
    },
    setCat: (pages) => {
        app.state.catPage = pages;
        const dl = document.getElementById('door-list'); dl.innerHTML = '';
        const valid = DB.doors.filter(d => d.mat === app.state.mat && pages.includes(d.page) && d.variants.some(v => v.h === app.state.h && v.w === app.state.w) && (d.configs==="all" || d.configs.includes(app.state.config.id)));
        if(valid.length === 0) dl.innerHTML = '<div style="text-align:center; padding:20px; color:#666">No doors match selection.</div>';
        valid.forEach(d => {
            let p = d.price.us > 0 ? d.price.us : d.price.ug;
            dl.innerHTML += `<div class="card" style="display:flex; justify-content:space-between; text-align:left" onclick='app.setDoor(${JSON.stringify(d)})'><div><span class="card-title" style="margin-top:0">${d.name}</span></div><div style="font-weight:800; font-size:1.2rem;">From $${p}</div></div>`;
        });
        app.nav('v-doors');
    },
    setDoor: (d) => { app.state.door = d; app.initOptions(); app.nav('v-options'); },

    initOptions: () => {
        const d = app.state.door;
        document.getElementById('opt-door-name').innerText = d.name;
        document.getElementById('opt-config-name').innerText = `Config #${app.state.config.id} • ${app.state.swing}`;
        document.getElementById('glass-group').style.display = (d.price.ug > 0) ? 'block' : 'none';
        document.getElementById('caming-group').style.display = (d.hasCaming && d.price.ug > 0) ? 'block' : 'none';
        if(d.price.ug > 0) app.setOpt('glass', 'install');
        app.updatePrice();
    },
    setOpt: (key, val, el) => {
        app.state.opt[key] = val;
        if(key==='finish') {
            document.getElementById('fin-unf').classList.toggle('selected', val==='unf');
            document.getElementById('fin-pre').classList.toggle('selected', val==='pre');
            document.getElementById('stain-group').style.display = val==='pre' ? 'block' : 'none';
        }
        if(key==='glass') {
            document.getElementById('gl-open').classList.toggle('selected', val==='open');
            document.getElementById('gl-install').classList.toggle('selected', val==='install');
            document.getElementById('glass-texture').style.display = val==='install' ? 'block' : 'none';
        }
        if(key==='stain' && el) {
            document.querySelectorAll('#stain-list .chip').forEach(c=>c.classList.remove('selected'));
            el.classList.add('selected');
        }
        if(key==='caming') {
            document.getElementById('cam-patina').classList.toggle('selected', val==='Patina');
            document.getElementById('cam-zinc').classList.toggle('selected', val==='Zinc');
        }
        app.updatePrice();
    },

    calculatePrice: () => {
        const s = app.state; const d = s.door; const c = s.config; const o = s.opt;
        const slData = DB.sidelights.find(x => x.page === (d.page === 9 || d.page === 10 ? d.page : 9)) || DB.sidelights[0];
        
        let dPrice = 0;
        if(o.finish === 'unf') {
            dPrice = (o.glass==='install' && d.price.ug > 0) ? d.price.ug : d.price.us;
        } else {
            dPrice = (o.glass==='install' && d.price.pg > 0) ? d.price.pg : d.price.ps;
        }

        let slPrice = 0;
        if(c.sl > 0) {
            if(o.finish === 'unf') {
                slPrice = (o.glass==='install' && slData.price.ug > 0) ? slData.price.ug : slData.price.us;
            } else {
                slPrice = (o.glass==='install' && slData.price.pg > 0) ? slData.price.pg : slData.price.ps;
            }
        }

        return (dPrice * c.d) + (slPrice * c.sl);
    },

    updatePrice: () => {
        const total = app.calculatePrice();
        document.getElementById('opt-live-price').innerText = "$" + total.toLocaleString();
    },

    generateFullText: () => {
        const s = app.state; const d = s.door; const o = s.opt;
        let sku = d.baseId;
        
        if(d.hasCaming && o.caming === 'Zinc') {
            sku = sku.replace(/P(?=\d)/, 'Z')
                     .replace('CORP','CORZ')
                     .replace('DARP','DARZ')
                     .replace('PRIP','PRIZ')
                     .replace('HARP','HARZ');
        }
        if(!sku.includes('3068') && !sku.includes('3080')) sku += (s.h===68?"3068":"3080");
        
        let desc = sku;
        
        if(o.glass === 'install') {
            desc += " - " + o.texture;
        } else {
            desc += " - No Glass";
        }

        if(o.finish==='pre') {
            desc += " - Prefinished";
            if(o.stain) desc += " - " + o.stain;
        } else {
            desc += " - Unfinished";
        }

        if(s.swing) desc += " - " + s.swing;

        return desc;
    },

    renderReview: () => {
        const total = app.calculatePrice();
        const s = app.state; const d = s.door; const c = s.config; const o = s.opt;
        const slData = DB.sidelights.find(x => x.page === (d.page === 9 || d.page === 10 ? d.page : 9)) || DB.sidelights[0];
        
        let dPrice = o.finish === 'unf' ? ((o.glass==='install' && d.price.ug > 0) ? d.price.ug : d.price.us) : ((o.glass==='install' && d.price.pg > 0) ? d.price.pg : d.price.ps);
        let slPrice = 0;
        if(c.sl > 0) {
            slPrice = o.finish === 'unf' ? ((o.glass==='install' && slData.price.ug > 0) ? slData.price.ug : slData.price.us) : ((o.glass==='install' && slData.price.pg > 0) ? slData.price.pg : slData.price.ps);
        }

        const fullDesc = app.generateFullText();

        let html = `
            <table class="review-table">
                <tr><td colspan="2"><div class="sku-box">${fullDesc}</div></td></tr>
                <tr><td class="r-label">Door</td><td class="r-val"><b>${d.name}</b></td></tr>
                
                <tr>
                    <td colspan="2" class="line-item">
                        <span>${c.d}x Door Unit</span>
                        <span>$${dPrice.toLocaleString()}/ea</span>
                    </td>
                </tr>
        `;
        
        if(c.sl > 0) {
            html += `<tr>
                    <td colspan="2" class="line-item">
                        <span>${c.sl}x Sidelight (${o.slSize}")</span>
                        <span>$${slPrice.toLocaleString()}/ea</span>
                    </td>
                </tr>`;
        }

        if(c.t) html += `<tr><td class="r-label">Transom</td><td class="r-val" style="color:red">Included in SKU, Not Priced</td></tr>`;

        html += `</table>`;
        document.getElementById('review-content').innerHTML = html;
        document.getElementById('total-price').innerText = "$" + total.toLocaleString();
        app.nav('v-review');
    }
};
app.init();
</script>
</body>
</html>
